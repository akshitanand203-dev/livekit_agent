<!DOCTYPE html>
<html>
<head>
  <title>LiveKit Voice Agent Test</title>

  <script type="module">
    import { Room, RemoteParticipant, RemoteTrack, RemoteTrackPublication } 
      from "https://cdn.jsdelivr.net/npm/livekit-client/dist/livekit-client.esm.js";

    async function startAgent() {
      try {
        // Get token + URL from backend
        const res = await fetch("/api/token");
        const { token, wsUrl } = await res.json();

        const room = new Room({
          adaptiveStream: true,
          dynacast: true
        });

        room.on(RoomEvent.TrackSubscribed, (track, publication, participant) => {
          if (track.kind === "audio") {
            const audio = document.getElementById("audio");
            track.attach(audio);
          }
        });

        await room.connect(wsUrl, token);
        console.log("Connected to room:", room.name);

      } catch (err) {
        console.error(err);
        alert("Failed to connect to agent");
      }
    }

    window.startAgent = startAgent;
  </script>

  <style>
    body {
      background: #111;
      color: white;
      text-align: center;
      padding-top: 100px;
      font-family: Arial, sans-serif;
    }
    button {
      background: #22c55e;
      padding: 15px 30px;
      font-size: 22px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      color: white;
    }
  </style>
</head>

<body>
  <h1>ðŸŽ¤ LiveKit Agent Test</h1>
  <p>Click to hear your agent</p>

  <button onclick="startAgent()">Start Agent</button>
  <audio id="audio" autoplay></audio>

</body>
</html>
